1) Общая стилистика: “стекло + чистая типографика”

Цель: современный, спокойный интерфейс, без кислотных цветов и без перегруза.

Основа UI — светлая/тёмная тема (если есть), но в любом случае:

фон экранов: мягкий, чуть сероватый (#F6F7FB или colors.background)

карточки: “glass” эффект — лёгкая полупрозрачность, мягкая граница, лёгкая тень

основной акцент — colors.primary (твоя фиолетовая/брендовая), но использовать аккуратно

Карточки должны выглядеть как:

фон: белый/полупрозрачный

border: 1px с лёгким colors.borderLight

радиус: 16–20

тень: мягкая, не жирная

внутри — сетка отступов 12–16

2) Токены (единые значения)

Это важно: Replit должен сделать единые “токены” и использовать их везде.

Отступы (spacing):

xs = 6

sm = 10

md = 14

lg = 16

xl = 20

Радиусы (radius):

sm = 12

md = 16

lg = 20

pill = 999

Шрифты (sizes):

11 — подписи/бейджи

13 — вторичный текст

14 — основной текст

16 — заголовки карточек/имя клиента

18 — крупные заголовки

Высоты кнопок/тач-таргеты:

минимум 42x42 для круглых action-кнопок (как у тебя)

высота строки/нажатия — минимум 44

3) Типографика

Заголовок карточки: 16, semiBold

Текст строк (адрес, дата): 14, regular

Вторичный текст: 13–14, regular, colors.textSecondary

Бейджи: 11–12, semiBold, капсула

Важно: не должно быть “каши” на мобиле:

ограничение строк numberOfLines

адрес в 2 строки максимум

всё остальное — 1 строка

4) Компонент “GlassCard” (обязателен)

Это визуальный фундамент.

Внешний вид:

backgroundColor: colors.card (или rgba(255,255,255,0.75) в светлой теме)

border: 1px solid colors.borderLight

borderRadius: 18

shadow: мягкий

overflow: hidden

Состояния:

overdue: borderColor = colors.error + "55" (как у тебя), и лёгкий красноватый фон у бейджа “Просрочен”

pressed: лёгкий scale 0.995, opacity 0.96

5) Карточка заказа (OrderCard) — структура

Карточка всегда выглядит одинаково по скелету, чтобы не прыгала:

Header (верх)

слева: #номер (если есть) + StatusBadge

справа: бейдж “Просрочен” если overdue

Main (середина)

если роль MANAGER/OWNER: имя клиента (жирнее)

адрес (иконка location + текст)

время (иконка time + формат даты)

Payment row (если показываем сумму)

иконка cash

сумма жирная, цвет primary

справа: капсула оплаты (“Оплачено / Не оплачено / Предоплата”), тоже primary, но светлый фон

Source row (источник клиента)

отображается всегда если есть clientSource

слева: круглая иконка источника (цвет зависит от источника)

текст источника (“WhatsApp / Telegram / ...”)

если источник чатовый и есть ссылка — справа маленькая иконка open и row кликабельная

Actions (низ)

Действия должны быть в одной линии, маленькие круглые кнопки:

Call (телефон)

Navigate (только курьер)

Chat (если есть)

Если нет действий — блок actions вообще не рисуем, но карточка не должна выглядеть “обрезанной”: просто нет нижней линии.

6) Цветовая логика источников

PHONE: серо-синий #607D8B

WHATSAPP: #25D366

TELEGRAM: #0088cc

INSTAGRAM: #E1306C

WEBSITE: #2196F3

OTHER: #9E9E9E

Фон кружка иконки: color + "14" (очень лёгкий оттенок)
Иконка: color чистый

7) Правила для мобильной читабельности

в каждой строке иконка 16 и текст

gap 8

numberOfLines на адрес 2

на слабых устройствах не использовать тяжёлые blur (если blur есть — сделать fallback)

ПРОМТ ДЛЯ REPLIT (серверная версия, без GitHub)

Скопируй и отправь Replit. Он должен создать/поправить код по этому ТЗ.

Ты — senior React Native (Expo) developer + TypeScript. У меня приложение “FloraOrders”. У тебя нет доступа к моим файлам, поэтому действуй по описанию ниже и создай/перепиши компоненты дизайна и связанные экраны так, чтобы:
1) UI был современным (glass card стиль), читабельным, без визуальной каши на мобиле
2) Весь код TypeScript компилировался без ошибок (tsc --noEmit OK)
3) Навигационные кнопки НЕ пропадали при обновлении страницы
4) Передача геопозиции курьеров работала стабильно

========================
A) ДИЗАЙН-СИСТЕМА
========================
Сделай единый дизайн с токенами:

Spacing:
xs=6, sm=10, md=14, lg=16, xl=20

Radius:
sm=12, md=16, lg=20, pill=999

Font sizes:
11 badge, 13 secondary, 14 body, 16 title, 18 header

Карточки:
- glass эффект: полупрозрачный фон, граница 1px, мягкая тень, радиус 18
- overflow hidden
- pressed: opacity 0.96 + scale 0.995

Создай компонент GlassCard:
- принимает props: padding?: number, style?: StyleProp<ViewStyle>, children
- внутри View с backgroundColor (в светлой теме rgba(255,255,255,0.75)), borderColor (легкий), shadow (мягкий)
- тип style обязательно StyleProp<ViewStyle>, иначе TS ошибки при style={[...]}

========================
B) OrderCard (карточка заказа)
========================
Создай/перепиши OrderCard так, чтобы:
- структура не прыгала
- кнопки действий аккуратные, круглые, минимум 42x42

Структура:
1) Header:
  слева: #orderNumber (если есть) + StatusBadge
  справа: если overdue, капсула "Просрочен" с иконкой alert-circle

2) Main:
  если роль MANAGER/OWNER: clientName (bold 16)
  строка адреса: location icon + address (2 lines max)
  строка времени: time icon + formatted date

3) Payment row:
  показывать только владельцу/менеджеру
  cash icon + amount primary bold
  справа payBadge капсула со статусом оплаты

4) Source row:
  если есть clientSource:
    кружок-иконка с цветом источника
    текст источника
    если источник чатовый (WhatsApp/Telegram/Instagram) и есть ссылка - row кликабельная, справа open icon

5) Actions row:
  showPhone: роль не FLORIST
  showNavigate: роль COURIER
  showChat: если chatUrl доступен
  если showActions true -> рисуем row с borderTop 1px и кнопками:
   - call (если phone есть)
   - navigate (если COURIER)
   - chat (если есть)

Важно:
- НЕ использовать несуществующую переменную user?.role
- showActions считать только из userRole + showPhone + showSourceChat
- SOURCE_ICONS должен иметь строгие типы, а order.clientSource может быть nullable -> проверяй перед доступом (иначе TS2538)

Цвета источников:
PHONE #607D8B
WHATSAPP #25D366
TELEGRAM #0088cc
INSTAGRAM #E1306C
WEBSITE #2196F3
OTHER #9E9E9E
фон под иконкой = color + "14"

========================
C) Типы OrderWithDetails
========================
Если UI использует order.manager/florist/courier объектами, то:
- сервер должен отдавать эти объекты, либо
- UI должен вычислять их из users списка по managerId/floristId/courierId

Сделай единообразно:
- либо расширь тип OrderWithDetails (manager?: UserLite | null, florist?: UserLite | null, courier?: UserLite | null)
- либо убери обращение к order.manager и показывай по Id

tsc ошибок быть не должно.

========================
D) Исправить проблему: пропадают навигационные кнопки при обновлении страницы
========================
Сделай правильный auth-guard:
- токен сохраняется в устойчивом storage
- при старте есть authLoading
- пока authLoading true -> показывается стабильный Splash/Loading экран
- только после восстановления токена/профиля строится навигация

В expo-router:
- в app/_layout.tsx и/или tabs layout:
  if (authLoading) return <Splash/>
  if (!currentUser) return <AuthStack/>
  else return <AppTabs/>

Исключи ситуации, когда header/tab buttons зависят от currentUser до его восстановления.

========================
E) Исправить передачу геопозиции курьеров
========================
Нужно:
- courier role отправляет координаты каждые 10-20 сек (foreground)
- запросы идут с Bearer token
- body: lat, lon, accuracy, recordedAt, activeOrderId(optional)

На клиенте:
- запросить Location permissions
- создать сервис useCourierLocationTracking:
  - включается только если userRole === COURIER и есть token
  - setInterval -> getCurrentPositionAsync -> POST на backend endpoint

На сервере:
- endpoint принимает координаты, берет organizationId из session/req.user
- сохраняет:
  - courier_location_latest (upsert по courierUserId + org)
  - courier_locations (insert history)
- все query params приводить к string через helper (string|string[] -> string)
- не использовать несуществующие поля (например courierUserId в orders если поле courierId)
- никаких Drizzle ошибок по .values (не передавать массив там, где нужен объект)

========================
F) Финальный чек
========================
В конце:
- покажи список файлов и что изменил
- подтверди, что TypeScript check проходит (tsc --noEmit OK)
- кратко объясни, как именно решена проблема навигации при refresh
- кратко объясни, как именно работает tracking геопозиции курьера